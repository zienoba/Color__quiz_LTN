/// @ 0.12.4

let title = 'ã“ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚«ãƒ©ãƒ¼ã ï½ã‚Œã ï¼Ÿ'
//1æ®µç›®ã®é¸æŠè‚¢ã®é…åˆ—
let initial = [
    {text: 'ã‚ï½ãŠ', value: '0'}, 
    {text: 'ã‹ï½ã“', value: '1'}, 
    {text: 'ã•ï½ã', value: '2'}, 
    {text: 'ãŸï½ã¨', value: '3'}, 
    {text: 'ãªï½ã®', value: '4'}, 
    {text: 'ã¯ï½ã»', value: '5'}, 
    {text: 'ã¾ï½ã‚‚', value: '6'}, 
    {text: 'ã‚„ï½ã‚ˆ', value: '7'}, 
    {text: 'ã‚‰ï½ã‚', value: '8'}]
//ã‚¢ã‚¤ãƒ‰ãƒ«åã®é…åˆ—
let idols = [
    ['ç§‹æœˆå¾‹å­', 'å¤©æµ·æ˜¥é¦™', 'ä¼Šå¹ç¿¼', 'ã‚¨ãƒŸãƒªãƒ¼', 'å¤§ç¥ç’°'], 
    ['æ˜¥æ—¥æœªæ¥', 'æˆ‘é‚£è¦‡éŸ¿', 'èŠåœ°çœŸ', 'å¦‚æœˆåƒæ—©', 'åŒ—ä¸Šéº—èŠ±', 'åŒ—æ²¢å¿—ä¿', 'æœ¨ä¸‹ã²ãªãŸ', 'é«˜å‚æµ·ç¾'], 
    ['æ¡œå®ˆæ­Œç¹”', 'ä½ç«¹ç¾å¥ˆå­', 'å››æ¡è²´éŸ³', 'ç¯ å®®å¯æ†', 'å³¶åŸã‚¨ãƒ¬ãƒŠ', 'ã‚¸ãƒ¥ãƒªã‚¢', 'ç™½çŸ³ç´¬', 'å‘¨é˜²æ¡ƒå­'], 
    ['é«˜æ§»ã‚„ã‚ˆã„', 'é«˜å±±ç´—ä»£å­', 'ç”°ä¸­ç´è‘‰', 'å¤©ç©ºæ©‹æœ‹èŠ±', 'å¾³å·ã¾ã¤ã‚Š', 'æ‰€æµç¾', 'è±Šå·é¢¨èŠ±'], 
    ['ä¸­è°·è‚²', 'æ°¸å‰æ˜´', 'ä¸ƒå°¾ç™¾åˆå­', 'äºŒéšå ‚åƒé¶´', 'é‡ã€…åŸèŒœ'], 
    ['è©åŸé›ªæ­©', 'ç®±å´æ˜Ÿæ¢¨èŠ±', 'é¦¬å ´ã“ã®ã¿', 'ç¦ç”°ã®ã‚Šå­', 'åŒæµ·äºœç¾/çœŸç¾', 'æ˜Ÿäº•ç¾å¸Œ'], 
    ['èˆæµœæ­©', 'çœŸå£ç‘å¸Œ', 'æ¾ç”°äºœåˆ©æ²™', 'ä¸‰æµ¦ã‚ãšã•', 'æ°´ç€¬ä¼Šç¹”', 'å®®å°¾ç¾ä¹Ÿ', 'æœ€ä¸Šé™é¦™', 'æœ›æœˆæå¥ˆ', 'ç™¾ç€¬è‰ç·’'], 
    ['çŸ¢å¹å¯å¥ˆ', 'æ¨ªå±±å¥ˆç·’'], 
    ['ãƒ­ã‚³']]
//å•é¡Œã®é…åˆ—
let problem_list = [
    {ans: 'ç§‹æœˆå¾‹å­', color: '#01a860'}, 
    {ans: 'å¤©æµ·æ˜¥é¦™', color: '#e22b30'}, 
    {ans: 'ä¼Šå¹ç¿¼', color: '#fed552'}, 
    {ans: 'ã‚¨ãƒŸãƒªãƒ¼', color: '#554171'}, 
    {ans: 'å¤§ç¥ç’°', color: '#ee762e'}, 
    {ans: 'æ˜¥æ—¥æœªæ¥', color: '#ea5b76'}, 
    {ans: 'æˆ‘é‚£è¦‡éŸ¿', color: '#01adb9'}, 
    {ans: 'èŠåœ°çœŸ', color: '#515558'}, 
    {ans: 'å¦‚æœˆåƒæ—©', color: '#2743d2'}, 
    {ans: 'åŒ—ä¸Šéº—èŠ±', color: '#6bb6b0'}, 
    {ans: 'åŒ—æ²¢å¿—ä¿', color: '#afa690'}, 
    {ans: 'æœ¨ä¸‹ã²ãªãŸ', color: '#d1342c'}, 
    {ans: 'é«˜å‚æµ·ç¾', color: '#e9739b'}, 
    {ans: 'æ¡œå®ˆæ­Œç¹”', color: '#274079'}, 
    {ans: 'ä½ç«¹ç¾å¥ˆå­', color: '#58a6dc'}, 
    {ans: 'å››æ¡è²´éŸ³', color: '#a6126a'},
    {ans: 'ç¯ å®®å¯æ†', color: '#b63b40'}, 
    {ans: 'å³¶åŸã‚¨ãƒ¬ãƒŠ', color: '#9bce92'}, 
    {ans: 'ã‚¸ãƒ¥ãƒªã‚¢', color: '#d7385f'}, 
    {ans: 'ç™½çŸ³ç´¬', color: '#b6b3e2'}, 
    {ans: 'å‘¨é˜²æ¡ƒå­', color: '#efb864'}, 
    {ans: 'é«˜æ§»ã‚„ã‚ˆã„', color: '#f39939'}, 
    {ans: 'é«˜å±±ç´—ä»£å­', color: '#7f6575'}, 
    {ans: 'ç”°ä¸­ç´è‘‰', color: '#92cfbb'}, 
    {ans: 'å¤©ç©ºæ©‹æœ‹èŠ±', color: '#bee3e3'}, 
    {ans: 'å¾³å·ã¾ã¤ã‚Š', color: '#5abfb7'}, 
    {ans: 'æ‰€æµç¾', color: '#454341'}, 
    {ans: 'è±Šå·é¢¨èŠ±', color: '#7278a8'}, 
    {ans: 'ä¸­è°·è‚²', color: '#f7e78e'}, 
    {ans: 'æ°¸å‰æ˜´', color: '#aeb49c'}, 
    {ans: 'ä¸ƒå°¾ç™¾åˆå­', color: '#c7b83c'}, 
    {ans: 'äºŒéšå ‚åƒé¶´', color: '#f19557'}, 
    {ans: 'é‡ã€…åŸèŒœ', color: '#eb613f'}, 
    {ans: 'è©åŸé›ªæ­©', color: '#d3dde9'}, 
    {ans: 'ç®±å´æ˜Ÿæ¢¨èŠ±', color: '#ed90ba'}, 
    {ans: 'é¦¬å ´ã“ã®ã¿', color: '#f1becb'}, 
    {ans: 'ç¦ç”°ã®ã‚Šå­', color: '#eceb70'}, 
    {ans: 'åŒæµ·äºœç¾/çœŸç¾', color: '#ffe43f'}, 
    {ans: 'æ˜Ÿäº•ç¾å¸Œ', color: '#b4e04b'}, 
    {ans: 'èˆæµœæ­©', color: '#e25a9b'}, 
    {ans: 'çœŸå£ç‘å¸Œ', color: '#99b7dc'}, 
    {ans: 'æ¾ç”°äºœåˆ©æ²™', color: '#b54461'}, 
    {ans: 'ä¸‰æµ¦ã‚ãšã•', color: '#9238be'}, 
    {ans: 'æ°´ç€¬ä¼Šç¹”', color: '#fd99e1'}, 
    {ans: 'å®®å°¾ç¾ä¹Ÿ', color: '#d7a96b'}, 
    {ans: 'æœ€ä¸Šé™é¦™', color: '#6495cf'}, 
    {ans: 'æœ›æœˆæå¥ˆ', color: '#7e6ca8'}, 
    {ans: 'ç™¾ç€¬è‰ç·’', color: '#f19591'}, 
    {ans: 'çŸ¢å¹å¯å¥ˆ', color: '#f5ad3b'}, 
    {ans: 'æ¨ªå±±å¥ˆç·’', color: '#788bc5'}, 
    {ans: 'ãƒ­ã‚³', color: '#fff03c'}]
//ä¹±æ•°ç”Ÿæˆå™¨ã®seedã‚’æŒ‡å®š
let random = Math:gen_rng(`{USER_ID}{Date:now()}`)
//ä½¿ç”¨ã™ã‚‹å•é¡Œ
let problems = []
//å•é¡Œæ•°
let problem_count = 5

let swap = @(list, i, j){
	let a = list[i]
	list[i] = list[j]
	list[j] = a
}

//é…åˆ—ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼ˆFisherâ€“Yatesæ³•ï¼‰
for let i2 = 1, problem_list.len {
	let i = problem_list.len - i2
	let j = Math:floor(random() * (i + 1))
	swap(problem_list, i, j)
}

//å…ˆé ­ã®problem_countå€‹ã‚’ä½¿ç”¨
for let i, problem_count {
	problems.push(problem_list[i])
}

//å•é¡Œã®UIã‚’æ ¼ç´ã™ã‚‹é…åˆ—ï¼Ÿ
let qaEls = [Ui:C:container({
	align: 'center'
	children: [
		Ui:C:text({
			size: 1.5
			bold: true
			text: title
		})
	]
})]

//å•é¡Œã®UIã‚’ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
var qn = 0
each (let qa, problems) {
	qn += 1
	qa.id = Util:uuid()
	qa.problem_number = qn
	qaEls.push(Ui:C:container({
		align: 'center'
		padding: 16
		rounded: true
		children: [
			Ui:C:text({
				text: `Q{qn}`
			})
			Ui:C:container({
				align: 'center'
    		children: [
    			//è‰²æç¤ºã®ç¸¦ã®é•·ã•ã‚’æŒ‡å®š
        	Ui:C:mfm({ text: [
            	""
            	""
            	""
            	""
            	""
            	""
            	""
            	""
        	].join(Str:lf) })
    		]
				borderWidth: 4
    		padding: 18
    		rounded: true
				bgColor: `{qa.color}`
			})
			Ui:C:text({
				text: "é ­æ–‡å­—"
			})
			Ui:C:select({
				items: initial
				onChange: @(u) { 
					Ui:get(`second_selector:{qa.id}`).update({items: idols[u.to_num()].map(@(c) {{ text: c, value: c }})})
				}
			})
			Ui:C:text({
				text: "ã‚¢ã‚¤ãƒ‰ãƒ«å"
			})
			Ui:C:select({
				items: idols[0].map(@(c) {{ text: c, value: c }})
				onChange: @(v) { qa.userAnswer = v }
			}, `second_selector:{qa.id}`)
			Ui:C:container({
				children: []
			} `{qa.id}:a`)
		]
	} qa.id))
}

//çµ‚äº†æ™‚
@finish() {
	var score = 0
	//æ­£ç­”ã¨æ­£èª¤ã‚’æ ¼ç´
	let post_text = []
	each (let qa, problems) {
		let correct = qa.userAnswer == qa.ans
		if (correct) {
			score += 1
			post_text.push(`Q{qa.problem_number}: {qa.ans} ğŸ‰æ­£è§£`)
		} else {
			post_text.push(`Q{qa.problem_number}: {qa.ans} âœ–ä¸æ­£è§£`)
		}
		let el = Ui:get(`{qa.id}:a`)
		el.update({
			children: [
				Ui:C:text({
					size: 1.2
					bold: true
					color: if (correct) '#f00' else '#00f'
					text: if (correct) 'ğŸ‰æ­£è§£' else `âœ–ä¸æ­£è§£`
				})
				Ui:C:text({
					size: 1.2
					bold: true
					color: if (correct) '#f00' else '#00f'
					text: if (correct) '' else `æ­£è§£:{qa.ans}`
				})
			]
		})
	}

	//å…ˆé ­ã®æ­£ç­”æ•°ã‚’è¿½åŠ 
	post_text.unshift(`{title}ã®çµæœã¯{problems.len}å•ä¸­{score}å•æ­£è§£ã§ã—ãŸã€‚`)
	let result = post_text.join(Str:lf)
	
	Ui:get('footer').update({
		children: [
			Ui:C:postFormButton({
				text: 'çµæœã‚’å…±æœ‰'
				rounded: true
				primary: true
				form: {
					text: `{result}{Str:lf}{THIS_URL} #Color2idol`
				}
			})
		]
	})
}

qaEls.push(Ui:C:container({
	align: 'center'
	children: [
		Ui:C:button({
			text: 'ç­”ãˆåˆã‚ã›'
			primary: true
			rounded: true
			onClick: finish
		})
	]
} 'footer'))

Ui:render(qaEls)
